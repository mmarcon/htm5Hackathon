<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Nokia Maps Mashup</title>
		<style>
		html,body, #mapContainer {
			font-family: sans-serif;
			background: #fff;
			color: #444;
			height: 100%;
			padding:0;
			margin:0;
		}

		.listener {
			width: 50px;
			height: 50px;
			position: absolute;
			top: 50%;
			left: 50%;
			margin: -25px 0 0 -25px;
		}

		</style>
		<script src="http://api.maps.nokia.com/2.2.0/jsl.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
		<link rel="icon" href="http://maps.nokia.com/favicon.ico">
	</head>
	<body>
		<div id="mapContainer"></div>
		<img class="listener" src="arrow.png"></img>
		<script>
		(function() {
		    init = function() {
				
		        // Authentication set-up is the first thing that you must do with the API 
		        nokia.maps.util.ApplicationContext.set({
		            "appId": "YOUR_APP_ID",
		            "authenticationToken": "YOUR_AUTHENTICATION_TOKEN"
		        });

		        createMap();
		        // ensureSize();

				// This makes sure the map is always the right size
		        // $(window).resize(ensureSize);
		    };
		    createMap = function() {
		        var mapContainer = document.getElementById("mapContainer"),
		        	map = new nokia.maps.map.Display(mapContainer, {
		            center: [52.51, 13.4],
		            zoomLevel: 5,
		            components: [
		                new nokia.maps.map.component.ZoomBar(),
		                new nokia.maps.map.component.Behavior(),
		                new nokia.maps.map.component.TypeSelector(),
		                new nokia.maps.map.component.Traffic(),
		                new nokia.maps.map.component.PublicTransport(),
		                new nokia.maps.map.component.Overview(),
		                new nokia.maps.map.component.ScaleBar(),
		                new nokia.maps.positioning.component.Positioning()
		                ]
		        });
		    };

		    ensureSize = function() {
		        // $('#mapContainer').height($('body').height() - $('#header').height());
		    };

		    var APP = window.APP = {}, L;

		    APP.Listener = function(initialPos){
		    	this.domObj = $('.listener')[0];
		    	this.pos = initialPos || {lat: null, lng: null, orientation: null};
		    };

		    L = APP.Listener.prototype;

		    L.setLatLng = function(lat, lng) {
		    	this.pos.lat = lat;
		    	this.pos.lng = lng;
		    };

		    L.setOrientation = function(orientation) {
		    	// Orientation here is normalised to match the Audio API rotation
		    	// i.e. it starts at Math.PI/2 and rotates counter-clockwise
		    	this.pos.orientation = (Math.PI/2)-orientation;
		    	this.domObj.style[this.vendorPrefixed("transform")] = "rotate("+this.pos.orientation+"rad)";
		    };

		    L.getPosition = function() {
		    	return this.pos;
		    };

		    L.getOrientation = function() {
		    	return (Math.PI/2)-this.pos.orientation;
		    };

		    L.vendorPrefixed = function(s){return eval(0+"O-Moz-Webkit-Ms-".replace(/.*?-|$/g,"||(s='$&"+s+"')in new Image().style&&s").replace(/-(.)/g,"'+'$1'.toUpperCase()+'"))}

		    $(function() {
		        init();
		        a = new APP.Listener()
		    });
		})();
		</script>
	</body>
</html>
